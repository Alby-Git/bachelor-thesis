<tool id="profile2cami" name="Profile2CAMI" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Convert metagenomic profile table to CAMI format</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code">
    <![CDATA[
        taxonkit profile2cami
        --data-dir '${taxonomy.fields.path}'
        --abundance-field '${abundance_field}'
        --taxid-field '${taxid_field}'
        #if $percentage:
            -p
        #end if
        #if $recompute_abd:
            -R
        #end if
        #if $keep_zero:
            -0
        #end if
        #if $sample_id:
            -s '${sample_id}'
        #end if
        #if $taxonomy_id:
            -t '${taxonomy_id}'
        #end if
        --show-rank '${show_rank}'
        ${input_file}
        > '${cami_output}'
    ]]>
    </command>
    <inputs>
        <param name="input_file" type="data" format="txt" label="Input Profile File" help="Input the tab-delimited profile file with TaxId and abundance columns." />
        <param argument="--taxonomy" type="select" label="NCBI taxonomy" help="To have actual human-readable taxon names in the standardised output">
            <options from_data_table="ncbi_taxonomy">
                <validator message="No NCBI database is available" type="no_options"/>
            </options>
        </param>
        <param name="abundance_field" type="integer" value="2" label="Abundance Field Index" help="Field index of abundance in the input data." />
        <param name="taxid_field" type="integer" value="1" label="TaxId Field Index" help="Field index of TaxId in the input data." />
        <param name="percentage" type="boolean" value="false" label="Abundance in Percentage" help="Check if the abundance values are in percentage." />
        <param name="recompute_abd" type="boolean" value="false" label="Recompute Abundance" help="Check to recompute abundance if some TaxIds are deleted in the current taxonomy version." />
        <param name="keep_zero" type="boolean" value="false" label="Keep Zero Abundances" help="Check to keep taxons with abundance of zero." />
        <param name="sample_id" type="text" value="" label="Sample ID" help="Optional sample ID to include in the result file." />
        <param name="taxonomy_id" type="text" value="" label="Taxonomy ID" help="Optional taxonomy ID to include in the result file." />
        <param name="show_rank" type="text" value="superkingdom,phylum,class,order,family,genus,species,strain" label="Show Ranks" help="Specify the ranks to show in the result file." />
    </inputs>
    <outputs>
        <data name="cami_output" format="tsv" label="Converted CAMI Output" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_file" value="test_profile.txt" ftype="txt" />
            <output name="cami_output">
                <assert_contents>
                    <has_text text="CAMI" n="1" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help>
    <![CDATA[
        **What is Profile2CAMI**

        Profile2CAMI is a tool for converting metagenomic profile tables to CAMI format.

        **Inputs**

        - A tab-delimited profile file with TaxId and abundance columns.

        **Outputs**

        - A CAMI formatted file.

        **Parameters**

        - Abundance Field Index: Field index of the abundance column in the input data.
        - TaxId Field Index: Field index of the TaxId column in the input data.
        - Abundance in Percentage: Check if the abundance values are in percentage.
        - Recompute Abundance: Check to recompute abundance if some TaxIds are deleted in the current taxonomy version.
        - Keep Zero Abundances: Check to keep taxons with abundance of zero.
        - Sample ID: Optional sample ID to include in the result file.
        - Taxonomy ID: Optional taxonomy ID to include in the result file.
        - Show Ranks: Specify the ranks to show in the result file.

        For more information, please refer to the tool's documentation.
    ]]>
    </help>
    <expand macro="citations" />
</tool>